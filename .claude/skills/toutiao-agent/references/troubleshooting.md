# 故障排查指南

## 登录问题

### Cookie 失效
**症状**: 首次运行正常，后续运行提示未登录
**解决**: 删除 `data/cookies.json`，重新登录

### 验证码处理
**症状**: 登录后停留在 auth 页面
**解决**: 确保配置中 `headless: false`，在打开的浏览器中手动完成验证

### 登录按钮点击失败
**症状**: 提示"未找到登录按钮"
**检查**: 页面是否完全加载，网络延迟情况

## 评论问题

### 未找到评论输入框
**症状**: `post_comment` 返回 `'未找到评论输入框'`
**可能原因**:
1. 页面未完全加载
2. 文章ID无效
3. 需要登录才能评论

### 评论发布无响应
**症状**: 点击提交后无结果
**检查**:
1. 内容是否触发审核
2. 是否频繁发布被限制

## 热点获取问题

### 获取新闻数量不足
**症状**: 请求20条，返回少于20条
**可能原因**:
1. 已有部分文章被评论过（自动过滤）
2. 页面选择器变化
3. 网络延迟导致页面加载不完整

## 数据库问题

### SQLite 锁定
**症状**: `database is locked`
**解决**: 关闭其他运行中的进程

### 文章ID冲突
**症状**: `UNIQUE constraint failed: comments.article_id`
**原因**: 尝试重复记录已评论的文章
**正常**: storage 层会检查，但直接插入可能触发

## 调试命令

```bash
# 检查配置
uv run toutiao-agent config-show

# 查看历史记录
uv run toutiao-agent history --limit 50

# 查看统计
uv run toutiao-agent stats

# 手动测试登录（headless=false）
# 修改 config.yaml 设置 headless: false
```

## 日志和截图

登录过程会自动保存调试截图到项目根目录：
- `debug_*.png` - 各步骤失败时的截图
- 检查截图可快速定位问题
