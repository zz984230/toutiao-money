# 进化日志

记录 toutiao-explorer 的能力进化历史。

## 进化统计

- 总进化次数: 4
- 成功解决问题: 4
- 新增活动模式: 2
- 上次进化: 2026-02-13

---

## 最近进化

### [E004] 2026-02-13 - 活动参与频率规则优化

**触发**: 用户主动反馈

**问题**:
- 用户指出两个重要规则未在技能文档中体现：
  1. 已经参与的活动应避免多次参与
  2. 每日幸运签等每日任务可以每天参与一次

**分析**:
- 一次性活动和每日任务需要不同的处理逻辑
- `storage.is_activity_participated()` 只能判断是否曾经参与，无法区分每日任务
- 每日任务需要检查"上次参与日期"是否是今天

**解决方案**:
1. 更新 SKILL.md：在可行性筛选中添加"避免重复参与已参与活动"规则
2. 更新 ACTIVITY_TYPES.md：添加"一次性活动"和"每日活动"的分类说明
3. 更新 PATTERNS.md：在模式3（每日签到/打卡）中添加：
   - 每日任务判断逻辑代码示例
   - 明确"每天可参与一次"的特性
   - 添加 `can_participate_daily()` 函数示例

**验证状态**: ✅ 已更新技能文档
**技能同步**: 已同步 SKILL.md, ACTIVITY_TYPES.md, PATTERNS.md

---

### [E003] 2026-02-13 - 活动参与入口优化（从活动页面发布）

**触发**: 用户主动反馈

**问题**:
- 用户指出从微头条页面发布带话题标签的内容，可能不被识别为参与活动
- 活动需要正确的话题标签和参与上下文才能计入

**分析**:
- **从活动页面进入发布**更可靠：
  - 活动页面会自动带上正确的话题标签
  - 确保发布的内容被计入活动参与
  - 页面上下文包含活动 ID 和参与关系
- **从微头条页面直接发布**存在风险：
  - 需要手动添加话题标签（如 `#天南地北大拜年#`）
  - 可能因为缺少活动上下文而不被识别
  - 即使有话题标签也可能无法参与成功

**解决方案**:
1. 活动参与流程更新为：活动页面 → 点击「发布微头条」按钮 → 在弹出的输入框中发布
2. 优先使用活动页面的发布入口，而非直接从微头条发布页面发布
3. 记录活动参与时必须是从活动页面触发的发布行为

**验证状态**: ⚠️ 正在验证中（需确认点击"发布微头条"后的具体行为）
**技能同步**: 待同步 STRATEGIES.md 和 PATTERNS.md

---

### [E002] 2026-02-13 - ActivityAnalyzer 页面直接分析能力

**触发**: 用户主动反馈

**问题**:
- ActivityAnalyzer 使用 subprocess 调用 playwright-cli 命令行工具
- 命令行工具可能在某些环境下无法正确执行
- 导致分析器返回置信度 0%，无法正确识别活动页面

**分析**:
- 活动页面已通过 `open_creator_center()` 和 `click_activity_card()` 加载
- 不需要再次通过 subprocess 截取和分析页面
- 可以直接在已加载的 page 上执行 JavaScript 分析

**解决方案**:
1. 新增 `analyze_from_page()` 方法
   - 直接接受 Playwright Page 对象
   - 在页面中执行 JavaScript 检测元素：
     - 输入框（`[contenteditable="true"]` 或 `textarea`）
     - 发布按钮（包含"发布"、"发送"、"提交"等关键词）
     - 活动卡片链接（用于验证是否在活动页面）
2. 根据检测结果返回更精确的操作类型：
   - 检测到输入框 + 发布按钮 → GENERATE_CONTENT（高置信度 0.95）
   - 检测到输入框但无发布按钮 → GENERATE_CONTENT（中置信度 0.70，提示需先点击参与按钮）
   - 检测到活动卡片 → 确认在活动页面（置信度 1.0）

**验证状态**: ✅ 测试通过（置信度从 0% 提升到 95%）
**技能同步**: 已更新 ACTIVITY_ANALYZER.md，添加 analyze_from_page() 方法

---

### [E001] 2026-02-13 - 活动参与方式修正

**触发**: 用户主动反馈

**问题**:
- 直接发布带话题标签的微头条后，用户删除了内容
- 原因：活动需要从活动页面点击按钮进入活动弹窗发布，而非直接发布微头条

**分析**:
- 活动URL格式：`mp.toutiao.com/profile_v3_public/public/activity/?activity_location=panel_invite_discuss_hot_mp&id={id}`
- `toutiao.com/activity/{id}` 格式返回404
- 活动入口：创作者中心首页 (mp.toutiao.com/profile_v4/index) 的活动卡片区域
- 点击活动卡片会打开新标签页或弹窗显示活动详情

**解决方案**:
1. 修改活动参与流程：访问创作者中心 → 点击活动卡片 → 在活动弹窗中参与
2. 更新 `ActivityAnalyzer` 使用正确的活动URL格式
3. 添加活动入口检测逻辑，识别卡片点击 vs 直接发布

**验证状态**: ⚠️ 需进一步验证
**技能同步**: 待同步 PATTERNS.md 和 STRATEGIES.md

---

## 进化分类索引

### 按触发类型
- 未知活动类型 → 暂无
- 连续失败 → 暂无
- 用户主动 → 暂无

### 按解决方案类型
- 新增活动模式 → E001 (2026-02-13)
- 页面结构更新 → E001 (2026-02-13)
- 策略优化 → E001 (2026-02-13)
- 内容模板 → 暂无

---

## 完整进化历史

按时间倒序排列。

### [E001] 2026-02-13 - 活动参与方式修正

**触发**: 用户主动反馈

**问题**:
- 直接发布带话题标签的微头条后，用户删除了内容
- 原因：活动需要从活动页面点击按钮进入活动弹窗发布，而非直接发布微头条

**分析**:
- 活动URL格式：`mp.toutiao.com/profile_v3_public/public/activity/?activity_location=panel_invite_discuss_hot_mp&id={id}`
- `toutiao.com/activity/{id}` 格式返回404
- 活动入口：创作者中心首页 (mp.toutiao.com/profile_v4/index) 的活动卡片区域
- 点击活动卡片会打开新标签页或弹窗显示活动详情

**解决方案**:
1. 修改活动参与流程：访问创作者中心 → 点击活动卡片 → 在活动弹窗中参与
2. 更新 `ActivityAnalyzer` 使用正确的活动URL格式
3. 添加活动入口检测逻辑，识别卡片点击 vs 直接发布

**验证状态**: ⚠️ 需进一步验证
**技能同步**: 待同步 PATTERNS.md 和 STRATEGIES.md

---

## 进化条目模板

```markdown
### [E###] YYYY-MM-DD - 标题
**触发**: 未知活动类型 / 连续失败 / 用户主动
**问题**: 问题描述

**分析**:
- 关键发现 1
- 关键发现 2

**解决方案**:
1. 解决步骤 1
2. 解决步骤 2

**验证状态**: ✅ 已测试通过 / ⚠️ 需进一步验证 / ❌ 测试失败
**技能同步**: 已更新 XXX.md / 待同步 / 无需同步
```
