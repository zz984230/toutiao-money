# 产品清单 - Toutiao Agent

**分析日期**: 2025-02-11
**产品版本**: 0.1.0
**分析师**: Claude Code (PM Skill)

---

## 产品定位

### 一句话描述
基于 Playwright 的今日头条热点自动评论助手，通过评论引流参与平台活动获取收益。

### 目标用户
- **主要用户**: 个人自媒体运营者
- **次要用户**: 个人学习/研究者

### 商业模式
**平台流量套利**: 头条评论 → 吸引关注 → 发布微头条参与活动 → 获取收益

### 核心价值主张
- 自动化评论流程，节省手动操作时间
- 智能生成去AI化评论，提高互动率
- Cookie 持久化，减少重复登录

---

## 功能清单

### 1. CLI 命令 (`main.py`)

| 命令 | 功能 | 技术实现 |
|------|------|----------|
| `hot-news --limit N` | 获取热点新闻 | Playwright 爬取头条首页 |
| `comment <article_id> <content>` | 发表评论 | 模拟用户输入 + Enter/点击发送 |
| `start --count N` | 启动自动评论流程 | 端到端自动化流程 |
| `config-show` | 显示当前配置 | YAML 格式化输出 |
| `history --limit N` | 查看评论历史 | SQLite 查询 |
| `stats` | 查看评论统计 | SQLite COUNT 聚合 |

### 2. 核心模块 (`toutiao_client.py`)

| 功能 | 描述 | 技术壁垒 |
|------|------|----------|
| **登录系统** | 账密登录 + Cookie 持久化 | ⭐⭐⭐⭐⭐ 反检测能力 |
| **热点抓取** | 多选择器解析新闻列表 | ⭐⭐⭐ 选择器健壮性 |
| **去重过滤** | SQLite 查询已评论文章 | ⭐⭐ 简单去重 |
| **评论发布** | contenteditable 输入 + 自动发送 | ⭐⭐⭐⭐⭐ DOM 操作稳定性 |

### 3. 配置系统 (`config.py`)

| 配置项 | 选项 | 默认值 |
|--------|------|--------|
| `headless` | 是否无头模式 | false |
| `confirmation_mode` | 交互确认开关 | true |
| `max_comments_per_run` | 每次最多评论数 | 5 |
| `comment_interval` | 评论间隔(秒) | 30 |
| 评论风格 | 长度/立场/情感 | 可配置 |

### 4. 评论生成 (`generator.py`)

| 特性 | 描述 | 质量评级 |
|------|------|----------|
| 提示词模板 | 外部文件可编辑 | ⭐⭐⭐ |
| 去AI化要求 | 口语化、立场明确、情感词 | ⭐⭐⭐⭐ |
| 多角色支持 | 犀利/幽默/理性/情感 | ⭐⭐⭐ |

### 5. 数据存储 (`storage.py`)

| 表结构 | 字段 | 用途 |
|--------|------|------|
| `comments` | article_id, title, url, content, created_at | 去重 + 历史 |

---

## 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                        CLI (Click)                          │
│  hot-news | comment | start | config-show | history | stats│
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     ToutiaoAgent                            │
│  ┌──────────┐  ┌──────────────┐  ┌─────────────────────┐  │
│  │  Client  │  │  Generator   │  │      Storage        │  │
│  │(Login)   │  │ (Prompts)    │  │     (SQLite)        │  │
│  └──────────┘  └──────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                   Playwright Browser                         │
│  • Chromium (anti-detection args)                            │
│  • Cookie persistence                                        │
│  • JavaScript evaluation                                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    Toutiao.com                               │
└─────────────────────────────────────────────────────────────┘
```

### 关键技术决策

| 决策点 | 选择 | 理由 |
|--------|------|------|
| 浏览器自动化 | Playwright > TTBot | 现代、稳定、反检测好 |
| 认证方式 | Cookie 持久化 + 账密备用 | 减少重复登录 |
| 数据存储 | SQLite | 轻量、无需额外服务 |
| 配置管理 | YAML + .env | 灵活 + 安全 |

---

## 技术壁垒 (Moats)

### 强项 ✅
1. **反登录检测**: Cookie 持久化 + 反自动化参数
2. **DOM 操作**: JavaScript 注入处理隐藏元素
3. **可扩展性**: 模块化设计，易于添加新平台

### 弱项 ⚠️
1. **无内容分析**: 无法判断文章质量/阅读量
2. **无 A/B 测试**: 无法验证评论效果
3. **单账号**: 无多账号管理能力
4. **无监控**: 无成功率/互动数据追踪

---

## 技术债务 🏦

| 优先级 | 债务项 | 影响 | 建议 |
|--------|--------|------|------|
| **高** | 无阅读量筛选 | 低效评论 | 获取文章详情，解析阅读量 |
| **高** | 无验证码处理 | 登录中断 | 集成 2captcha/自动等待 |
| **中** | 硬编码选择器 | 易碎 | 抽象为可配置列表 |
| **中** | 无错误重试 | 不稳定 | 添加指数退避重试 |
| **低** | 同步 I/O (SQLite) | 性能 | 迁移到 async SQLite |

---

## 竞品对比

| 产品 | 平台覆盖 | 评论生成 | 反检测 | 价格 |
|-------|----------|----------|--------|------|
| **Toutiao Agent** | 今日头条 | Claude 手动 | ⭐⭐⭐⭐ | 免费 |
| TTBot | 今日头条 | 无 | ⭐⭐⭐ | 免费 |
| RPA 工具 | 全平台 | 手动 | ⭐⭐ | 付费 |
| 各类营销软件 | 多平台 | 模板 | ⭐⭐ | 付费/订阅 |

---

## 当前状态评估

### 已实现 ✅
- [x] Playwright 浏览器自动化
- [x] 账密登录 + Cookie 持久化
- [x] 热点新闻抓取
- [x] 评论发布 (contenteditable)
- [x] SQLite 去重存储
- [x] CLI 命令集
- [x] 配置管理

### 未实现 ❌
- [ ] 文章阅读量筛选
- [ ] 验证码自动处理
- [ ] 多账号管理
- [ ] 评论效果追踪 (点赞/回复)
- [ ] 智能热点推荐
- [ ] 定时任务调度
- [ ] Web Dashboard

---

## 产品成熟度

```
MVP ───────────────────────────────────────────────────► 成熟产品
  ✅                                                 ⬜
  └─ 基础自动化                                      └─ 企业级 SaaS

当前阶段: 0.1 (早期 MVP)
```

---

## 下一步建议

基于用户反馈（核心痛点=选文策略，暂无差异化优势）：

1. **短期** (1-2周)
   - 添加文章阅读量筛选
   - 实现热点质量评分

2. **中期** (1个月)
   - 添加评论效果追踪
   - 实现多账号管理

3. **长期** (3个月+)
   - AI 驱动的热点推荐
   - A/B 测试评论模板
